<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Brick Game F1 - Classic Fidelity V8.0</title>
    <style>
        body { 
            background: #222; display: flex; flex-direction: column; justify-content: center; 
            align-items: center; min-height: 100vh; margin: 0; font-family: 'Courier New', monospace;
            touch-action: manipulation;
        }
        #console { 
            background: #f1c40f; border-radius: 15px; padding: 20px; 
            border-bottom: 12px solid #d4ac0d; box-shadow: 0 10px 0 #000;
            width: 250px; text-align: center;
        }
        #screen-border { 
            background: #8b956d; padding: 12px; border: 8px solid #333; 
            border-radius: 5px; position: relative; box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        canvas { 
            background: #94a074; display: block; image-rendering: pixelated; 
            width: 100%; height: auto; border: 1px solid rgba(0,0,0,0.2);
        }
        .hud { display: flex; justify-content: space-between; color: #111; font-weight: bold; margin-bottom: 8px; font-size: 16px; }
        .mobile-controls { display: flex; flex-direction: column; align-items: center; margin-top: 25px; gap: 20px; }
        .dpad { display: flex; gap: 20px; }
        .btn { 
            background: #333; color: white; border: none; border-radius: 50%; 
            width: 70px; height: 70px; font-size: 24px;
            box-shadow: 0 6px 0 #000; display: flex; align-items: center; justify-content: center;
            user-select: none; -webkit-tap-highlight-color: transparent;
        }
        .btn:active { transform: translateY(3px); box-shadow: 0 3px 0 #000; }
        .action-row { display: flex; gap: 15px; }
        .btn-small { 
            background: #c0392b; border-radius: 50%; width: 50px; height: 50px; 
            font-size: 10px; box-shadow: 0 4px 0 #7b241c; color: white; border: none; cursor: pointer;
        }
        .btn-green { background: #27ae60; box-shadow: 0 4px 0 #1e8449; }
    </style>
</head>
<body>

<div id="console">
    <div class="hud">
        <span>LVL:<span id="level">1</span>/10</span>
        <span>PTS:<span id="score">0</span></span>
    </div>
    <div id="screen-border">
        <canvas id="gameCanvas" width="210" height="400"></canvas>
    </div>

    <div class="mobile-controls">
        <div class="dpad">
            <div class="btn" id="leftBtn">◀</div>
            <div class="btn" id="rightBtn">▶</div>
        </div>
        <div class="action-row">
            <button class="btn btn-small btn-green" id="startBtn">START</button>
            <button class="btn btn-small" id="pauseBtn">PAUSE</button>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreDisplay = document.getElementById("score");
    const levelDisplay = document.getElementById("level");

    const COLS = 3, LANE_WIDTH = canvas.width / COLS, BLOCK = 18;
    let score = 0, level = 1, playerLane = 1, enemies = [], coins = [], frameCount = 0;
    let gameActive = false, isPaused = false, currentSpeed = 80, gameLoop;
    let uiMessage = "START", isGameOver = false;

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const sennaTheme = [392, 523, 659, 783, 0, 659, 783, 0, 659, 783, 880, 783, 698, 659, 587, 0];
    let noteIndex = 0;

    function playSound(freq, type, duration, vol = 0.05) {
        if (isPaused || !gameActive || freq === 0) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    }

    function drawBrick(x, y, opacity = 1, isCoin = false) {
        ctx.fillStyle = isCoin ? `rgba(17, 17, 17, ${Math.abs(Math.sin(frameCount/3))})` : `rgba(17, 17, 17, ${opacity})`;
        ctx.fillRect(x + 1, y + 1, BLOCK - 2, BLOCK - 2);
        ctx.strokeStyle = "rgba(0,0,0,0.1)";
        ctx.strokeRect(x, y, BLOCK, BLOCK);
    }

    // VOLTA DO CARRO CLÁSSICO DETALHADO (7 BLOCOS)
    function drawCar(lane, y, isPlayer = false) {
        const x = lane * LANE_WIDTH + (LANE_WIDTH/2) - (BLOCK/2);
        const alpha = isPlayer ? 1 : 0.85;
        // Desenho clássico: Ponta, Meio(3 blocos), Motor, Base(3 blocos)
        drawBrick(x, y, alpha); // Frente
        drawBrick(x-BLOCK, y+BLOCK, alpha); drawBrick(x, y+BLOCK, alpha); drawBrick(x+BLOCK, y+BLOCK, alpha); // Eixo frente
        drawBrick(x, y+(BLOCK*2), alpha); // Cockpit
        drawBrick(x-BLOCK, y+(BLOCK*3), alpha); drawBrick(x, y+(BLOCK*3), alpha); drawBrick(x+BLOCK, y+(BLOCK*3), alpha); // Eixo traseiro
    }

    function update() {
        if (!gameActive || isPaused) { 
            drawOverlay(); 
            return; 
        }

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        frameCount++;

        if (frameCount % 6 === 0) {
            playSound(sennaTheme[noteIndex], 'square', 0.2);
            noteIndex = (noteIndex + 1) % sennaTheme.length;
        }

        let spawnRate = Math.max(10, 30 - (level * 2));
        if (frameCount % Math.floor(spawnRate) === 0) {
            enemies.push({ lane: Math.floor(Math.random() * 3), y: -BLOCK * 4 });
        }

        if (frameCount % 100 === 0 && Math.random() > 0.7) {
            coins.push({ lane: Math.floor(Math.random() * 3), y: -BLOCK });
        }

        // Moedas
        for (let i = coins.length - 1; i >= 0; i--) {
            coins[i].y += (BLOCK / 3) + (level * 0.2);
            if (coins[i].lane === playerLane && coins[i].y > canvas.height - 80 && coins[i].y < canvas.height - 20) {
                score += 30; scoreDisplay.innerText = score;
                playSound(1200, 'sine', 0.1, 0.1);
                coins.splice(i, 1); checkLevel(); continue;
            }
            if (coins[i].y > canvas.height) coins.splice(i, 1);
            else drawBrick(coins[i].lane * LANE_WIDTH + (LANE_WIDTH/2) - (BLOCK/2), coins[i].y, 1, true);
        }

        // Inimigos com colisão precisa
        for (let i = enemies.length - 1; i >= 0; i--) {
            enemies[i].y += (BLOCK / 4) + (level * 0.4); 
            
            // Colisão ajustada para o tamanho real do carro clássico
            if (enemies[i].lane === playerLane && enemies[i].y + (BLOCK * 4) > canvas.height - 80 && enemies[i].y < canvas.height - 20) {
                gameOver();
                return; // Para o update imediatamente
            }

            if (enemies[i].y > canvas.height) {
                score += 10; scoreDisplay.innerText = score;
                enemies.splice(i, 1);
                checkLevel();
            } else {
                drawCar(enemies[i].lane, enemies[i].y);
            }
        }
        drawCar(playerLane, canvas.height - 80, true);
        
        if (uiMessage !== "") drawScreenText(uiMessage);
    }

    function checkLevel() {
        if (score > 0 && score % 100 === 0 && level < 10) levelUp();
    }

    function drawOverlay() {
        // Mantém os carros visíveis ao fundo no Game Over
        if (isGameOver) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            enemies.forEach(e => drawCar(e.lane, e.y));
            drawCar(playerLane, canvas.height - 80, true);
            drawScreenText("FIM JOGO");
        } else if (isPaused) {
            drawScreenText("PAUSA");
        } else {
            drawScreenText(uiMessage);
        }
    }

    function drawScreenText(text) {
        ctx.fillStyle = "rgba(0,0,0,0.2)";
        ctx.fillRect(0, canvas.height/2 - 25, canvas.width, 50);
        ctx.fillStyle = "#111";
        ctx.font = "bold 24px Courier New";
        ctx.textAlign = "center";
        ctx.fillText(text, canvas.width/2, canvas.height/2 + 8);
    }

    function levelUp() {
        level++; levelDisplay.innerText = level;
        currentSpeed = Math.max(25, 80 - (level * 6)); 
        uiMessage = "LEVEL " + level;
        clearInterval(gameLoop);
        gameLoop = setInterval(update, currentSpeed);
        playSound(800, 'square', 0.3);
        setTimeout(() => { if(gameActive) uiMessage = ""; }, 1500);
    }

    function gameOver() {
        gameActive = false;
        isGameOver = true;
        playSound(100, 'sawtooth', 0.6);
        clearInterval(gameLoop);
        drawOverlay(); // Força o desenho da mensagem no momento da batida
    }

    function move(dir) {
        if (!gameActive || isPaused) return;
        if (dir === 'L' && playerLane > 0) { playerLane--; playSound(440, 'sine', 0.05); }
        if (dir === 'R' && playerLane < 2) { playerLane++; playSound(440, 'sine', 0.05); }
    }

    function startGame() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        score = 0; level = 1; enemies = []; coins = []; playerLane = 1; noteIndex = 0;
        scoreDisplay.innerText = "0"; levelDisplay.innerText = "1";
        gameActive = true; isPaused = false; isGameOver = false; currentSpeed = 80;
        uiMessage = "";
        clearInterval(gameLoop);
        gameLoop = setInterval(update, currentSpeed);
    }

    document.getElementById("leftBtn").addEventListener("touchstart", (e) => { e.preventDefault(); move('L'); });
    document.getElementById("rightBtn").addEventListener("touchstart", (e) => { e.preventDefault(); move('R'); });
    document.getElementById("leftBtn").addEventListener("mousedown", (e) => { e.preventDefault(); move('L'); });
    document.getElementById("rightBtn").addEventListener("mousedown", (e) => { e.preventDefault(); move('R'); });
    document.getElementById("startBtn").addEventListener("click", startGame);
    document.getElementById("pauseBtn").addEventListener("click", () => { if (gameActive) isPaused = !isPaused; });

    drawOverlay();
</script>
</body>
</html>